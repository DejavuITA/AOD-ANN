\chapter{Samples, setup and experiments}
\label{ch:experiments}

All the experiments have been carried out on samples manufactured for the IRIS project \cite{testa2016design}.
This is due to the fact that in the time frame of this work there would have not been enough time to design and produce an ad hoc device.
Moreover, as already stated, the aim of this thesis is to produce a proof of concept for an all-optical implementation of an activation function, rather than to construct a complete prototype.
With the knowledge obtained during this work, future researches could design new structures by focusing on the correct parameters.

\section{The samples}
The IRIS project studied the design and the implementation of an integrated reconfigurable silicon photonics switch matrix, a routing device, as a replacement for electronic devices used in the telecommunication industry.
The completed integrated photonic circuit consists of a matrix of waveguides crossing each other and linked by couples of racetrack resonators, thermally-controlled.
At the ends of the waveguides other structures, interleavers and \acsp{AWG}, allowed many signals at different wavelengths to be multiplexed/demultiplexed onto/from the same waveguide.

The complexity of such photonic circuit required outstanding precision in the design and the fabrication.
Hence, for preliminary testing purposes, each and every structure of which the full device is composed, has been manufactured repeatedly with several small variations.
For example, several microrings in the \ac{ADF} configuration have been fabricated with different radius, or different ring-waveguide gap.
The collection of all these testing structures on the same chip was produced in a few samples.
All these test structures as well as a fully completed switch matrix were disposed on a single chip, accessible via grating couplers.

The first step of this work therefore has been to characterize qualitatively the response of some devices among the single structures, the short sequences of structures, and the full switch matrix itself.
After many trials of different devices, my final choice was to study a system of intermediate complexity.
In fact, since the work in this thesis is like the first step in a long journey, with this choice I tried to obtain a compromise between simplicity in immediate future (current work) and adaptability in the long term.
For example, the current structure allowed me to study the nonlinear activation function, but could be reused in the future to study the weighted sum.

The structure selected is the following: a simple waveguide, coupled to eight drop channels by a single or a couple of ring resonators each, nicknamed \textit{mini-matrix}.
In this family of devices, there were those built with single microrings, double microrings, single racetracks, or double racetracks.
The final choice was to study the \textit{mini-matrix} in which the coupling mechanism was provided by single ring resonators, because of its simpler transfer function in respect to double microrings or double racetracks.
\autoref{fig:photo_minimatrix} shows a magnified photograph of the device chose, while \autoref{fig:minimatrix_scheme} shows a simplified (not in scale) scheme of the principal sub-structures of the \textit{mini-matrix}.

\begin{figure}[htbp]
	\centering
	\includegraphics[scale=50]{figures/2017_10_31_foto_contatti_ring.jpg}
	\caption{Magnified photograph of the \textit{mini-matrix} device chosen. On the bottom, one input and nine output grating couplers are visible. }
	\label{fig:photo_minimatrix}
\end{figure}

\begin{figure}[hbtp]
	\centering
%	\includegraphics[scale=.4]{figures/miniMATRIX_Klayout.png}\\
	\input{tikz/miniMATRIX_scheme.tex}
	\caption{
		Simplified scheme of the \textit{mini-matrix} integrated photonic circuit, structures are not in scale.
		Triangles (orange) are the grating couplers ($in$, $dr_{1-8}$, $th$), with the orientation respected by the symbol orientation.
		Waveguides and rings ($r_{1-8}$) are shown as thick grey lines.
		The bigger (purple) highlighted area is a coupling region, the smaller (blue) area is a crossing between straight waveguides.
		Bendings, crossings, and grating coupler are nontrivial structures which have their own typical response to wavelength and power.
	}
	\label{fig:minimatrix_scheme}
\end{figure}

As an additional feature, each one of the microring resonators in the structure has been manufactured with thermo-electric heaters.
Their purpose \cite{testa2016design} is to heat the rings and effectively shift the resonance frequency, which otherwise would be defined strictly by the geometry of the structure.
\autoref{fig:minimatrix_scheme_zoom} shows the scheme of the microring resonator geometry, without any non-optical structure (e.g. heaters, metallic contacts).
%This feature has never been exploited in this work, but could come of use in the future.

\begin{figure}[htbp]
	\centering
%	\includegraphics[scale=.4]{figures/single_ring_zoom.png}\\
	\input{tikz/miniMATRIX_scheme_zoom.tex}
	\caption{
	Microring optical cavity region, structures are in scale.
	The ring has an internal radius of $R_{in}=\SI{4.43}{\um}$ and its width is of \SI{0.48}{\um}.
	The waveguides side coupled to the ring have a width of \SI{0.42}{\um} and distance from the ring of \SI{.175}{\um}.
	}
	\label{fig:minimatrix_scheme_zoom}
\end{figure}

\subsection{Initial characterization}
\label{ssec:initial_characterization}
To obtain an initial characterization of the sample, I arranged an experimental setup to measure its fundamental attributes.
Among them there are the position of the resonances, the \acf{FSR}, and the \acf{FWHM} of the resonance transmission function.
These features can all be obtained through a study of the transmitted intensity in the through and drop channels, shown in \autoref{fig:minimatrix_scheme}.
A scheme of the experimental setup used in showed in \autoref{fig:simple_setup} below.

\begin{figure}
	\centering
	\input{tikz/simple_setup.tex}
	\caption{Scheme of the setup used to obtain an initial characterization of the sample.
		The source is a TUNICS which produces a laser beam of up to \SI{8}{\mW} in the range of wavelength required (\SIrange{1500}{1580}{\nm}).
		The second element is an optical circulator and the third is a fiber coupler (50\%:50\%).
		Within the coupler the signal is split. One arm goes to an \ac{OSA}.
		The other arm takes the signal to a polarizer which is then injected into the sample and finally extracted to be read by a Germanium-based photodetector.
		}
	\label{fig:simple_setup}
\end{figure}

The laser source used in this measures is a Yamatsu TUNICS T-100S tunable infrared laser.
It produces a linearly polarized continuous wave laser beam of optical power up to \SI{8}{\mW} in the wavelength range \SIrange{1500}{1580}{\nm}, with a minimum wavelength step of \SI{1}{\pm}.
The generated light is injected into an optical circulator to protect the laser cavity from back-reflections.
A circulator is a device that works similarly to a roundabout: input signals from the first port are directed only toward the second port. Similarly, signals injected in the second port are guided in the third port only and so on.
The circulator used in the setup has four ports.
Afterwards the beam is divided into two equal parts by means of a fiber coupler: one is analyzed by an \acf{OSA} and the other is brought to the sample.

The presence of an \ac{OSA} after the source is due to the fact that the self-referencing mechanism of the laser was not reliable.
In fact, the actual wavelength emitted from it deviated rather sensibly from the supposed one.
In order to correct this problem, I sampled the supposed-actual wavelength relationship with the \ac{OSA}, which allowed me to implement an online correction by exploiting the relative inverse function.
In doing so, I assumed the \ac{OSA} as a reference with no error.

All structures built on the test chip are accessible via grating couplers.
Both the couplers and the photonic integrated circuits of IRIS are designed to support modes in the \acs{TE} polarization only.
Grating couplers are planar periodic structures engineered to couple light from free space into integrated waveguides and vice versa.
Due to geometrical constraint, they are built to work in a specific range of wavelengths and at a certain angle.
This means that light at wavelength in the predefined range, impinging on the grating coupler with the correct angle, is coupled inside the waveguide on the \ac{PIC}.
Similarly, light coming from a waveguide to a grating coupler, is radiated as plane wave from the grating coupler with the same mentioned angle.

The sample is therefore adjusted on a 2-\acs{DOF} linear stage in between two 3-\acs{DOF} linear stages that holds the input and output coupling fibers.
\autoref{fig:alignment} shows the respective position of input and output fibers in respect to the grating couplers.

\begin{figure}[htbp]
	\centering
	\input{tikz/alignment.tex}
	\caption{Alignment phase of the input and output fibers over the corresponding grating couplers.
	The optical fibers are aligned at an angle of \ang{14} over the grating couplers in such a way to inject and collect as much light as possible.
	The sample was placed in a specific slot of a copper sample holder, which was secured onto a 2-\acs{DOF} manual stage.
	The two fiber holders were placed on a 3-\acs{DOF} manual stage each, to obtain best alignment.
	The angle of the fiber holder tip was fixed during the assembly at \ang{14} from the surface normal.}
	\label{fig:alignment}
\end{figure}

Once secured the input and output optical fibers in place on the linear stages, the alignment phase begins.
First the source is turned on at a wavelength that transmit on the correct channel, for example the resonance wavelength transmit in the drop channels but not in the through channel and vice versa.
Then the optical fibers are carefully moved in the respective positions that maximize the coupled signal.
This procedure needs meticulous practice and method to avoid errors due to noise and imprecise movements of the linear stages.
Moreover, sometimes the procedure must be repeated even if neither the sample nor the fibers have been moved, because of mechanical relaxation processes of the inner gears.

To obtain the best results, I also designed two new modular fiber holders with fixed angle, that could be used more easily than the older ones with adjustable angle.
The main body has been manufactured in aluminum, except for the actual part that sustains the fiber, which was produced in iron.
The metallic tip of the holder, appropriately grooved to house the optical fiber, can hold still the fiber with the help of little magnets.
This techniques aims to reduce as much as possible the vibration of the fibers ends which causes fluctuations in the amount of light coupled to the gratings.

Since the \acp{PIC} developed for IRIS support \acs{TE} modes only, after the positions of the optical fibers have been optimized, the coupled signal is maximized by the use of a polarizer.
The polarizer, placed between the fiber coupler and the sample, is a device composed by a long optical fiber.
Such fiber is coiled in three separate loops which have the effect of a half-wavelength plate, one quarter-wave plate, and another half-wave plate respectively.
Each coil can be manipulated, in a similar manner to the bulky quater-/half-wave plates, to change the output (linear) polarization of the light.
The position of the polarization stage before of after the \ac{OSA} junction is not relevant as the \ac{OSA} is polarization independent.

In order to reduce further the impact of noise on measures, I also boxed the three linear stages with stiff walls.
This allowed to decrease the random fluctuations, due to movement of the fiber tips in the air, of at least one order of magnitude.

For the initial characterization of the structure, I studied the response of each output at input signals with low optical power and in a certain range of wavelengths (frequencies).
With this study, I identified the position of the resonances and their shape.
As shown in \autoref{fig:M3sweep}, the through channel $th$ follows the shape of the grating coupler response, which is centered around \SI{1550}{\um} and slowly drops with the growing relative distance from that wavelength.
Moreover, one can observe that the first drop channel $dr_1$ has the expected shape (lorentzian), with a free spectral range of $FSR=\SI{19.15+-.1}{\nm}$\ref{}.
On the other hand, all the other drop channels show a transmission that is perturbed by the light collected in the first channel.

\begin{figure}[htbp]
	\centering
%	\input{tikz/M1.tex}
%	\input{tikz/M2.tex}
	\input{tikz/M3.tex}
	\caption{
		Transmission spectra of the drop channels ($dr_1$ to $dr_8$) and through channel $th$.
		The $dr_1$ channel shows the expected shape, whereas the other drop channels are clearly disturbed by the first one.
		The through channel shows a shape similar to the expected one, but it is actually the results of all the drop channels.
	}
	\label{fig:M3sweep}
\end{figure}

Since the the first channel is the only one with an unperturbed transmission, I focused my attention on its response only.
Specifically, I studied the resonance near \SI{1550}{\um} because it was the one with the highest transmitted signal and hence provided a better \acs{SNR}.
\autoref{fig:M3_1550_resonance} shows such resonance and highlights its width to $FWHM=\SI{0.6+-0.1}{\nm}$\ref{}.
The estimated quality factor is $Q=\num{2600+-400}$\ref{}.

\begin{figure}[htbp]
	\centering
	\input{tikz/M3resonance.tex}
	\caption{
		Resonance near \SI{1552}{\nm}, transmission to the drop port $dr_1$.
		This spectrum is the only one unperturbed by the other transmission spectra.
		The FWHM and the resonance wavelength are clearly visible in the figure.
	}
	\label{fig:M3_1550_resonance}
\end{figure}

\section{Characterization of the Activation Function}
\label{sec:Characterization_of_the_Activation_Function}
To characterize the thermal bistability of the microring resonator the setup used for the initial measures was not enough.
In order to induce the thermal bistability effect in the microring I amplified the signal of the TUNICS with an \ac{EYDFA}.
Even more so with addition of the optical amplifier, the role of the circulator placed between the sources and the rest of the devices is of fundamental importance.
Back-reflected signals that enter optical amplifier in the wrong direction can cause serious damage to the equipment.

In addition to the amplifying stage, a remotely controlled \acfi{VOA} was added between the polarizer and the sample, in order to characterize with accuracy the response of the microring resonator to signals of fixed wavelength but different optical power.
The \ac{VOA} employed is controlled by a voltage signals in the range \SIrange{0}{5}{\V}.
It provides full transparency for \SI{0}{\V} and full attenuation for \SI{5}{\V} and, in between, the attenuator behaves similarly to a sigmoid function.
This curve has been identified with its closest analytical polynomial, to obtain an inverse formula that links transparency values in the range $[0,1]$ to the respective correct voltage value.

Theoretically, this setup is sufficient to measure the features of the bistability effect.
However, due to instabilities of the source and amplification stages, both in the optical power and in the wavelength of the signal, that is not the case.
Hence, an additional infrared photodetector was placed before the \ac{VOA}, completing the setup as shown in \autoref{fig:pump_setup}.

\begin{figure}[hbtp]
	\centering
	\input{tikz/pump_setup.tex}
	\caption{Scheme of the setup used to obtain characterization of the thermal bistability in the microring resonator.
		The source (TUNICS) is amplified by an \acs{EYDFA}, which can reach optical power up to several hundreds of \si{\mW}.
		The amplified source is followed by the circulator and by the fiber coupler (50\%:50\%), that splits the signal to the \acs{OSA} and to the polarizer.
		After the polarizer, a second fiber coupler (90\%:10\%) direct a small part of the signal to a second Germanium-based photodetector.
		The signal in the other arm passes through a \acf{VOA}, then it is injected into the sample, and finally extracted to be read by a Germanium-based photodetector.
		}
	\label{fig:pump_setup}
\end{figure}

The second infrared detector measures a small part (10\%) of the signal, which is collected from the main path via a fiber coupler (90\%:10\%).
Hence, in this configuration, the \ac{OSA} provides control over the wavelength of the source, while the photodetector provides control over the power emitted.
Unfortunately, the measures obtained by means of the \ac{OSA}, due to intrinsic limitations of the instrument and to the high complexity of the measure itself, have a much lower sampling rate in comparison to the measures given by the photodetectors.
For this reason, the \ac{OSA} has been employed as a before-and-after check on the light emitted by the source stages.

On the other hand, the second infrared detector was inserted in the measuring loops such that it collected data for each sampled point.
Therefore, the data collected is composed by the optical power measured before the \ac{VOA}, by the transparency of the \ac{VOA}, and by the optical power measured at the output.
This three-point measurement allowed more robustness against power fluctuations.

%Other than the addition discussed so far, the system setup is very similar to the one used before.
%The coupling system and alignment process of the sample are the same described above in \autoref{ssec:initial_characterization}.

\subsection{Bistability wavelength dependence}
\label{ssec:bistability_wavelength_dependence}
The first feature studied is the dependence on wavelength of the overall shape of the bistability hysteresis loop.
As seen in \autoref{ssec:Simulations}, the form of the bistability changes with the distance of the wavelength of light in respect to the wavelength of the resonance.
This behavior is also observed in the transmission spectra experimentally measured, as shown in \autoref{fig:bistability_shape} below.

\begin{figure}[hbtp]
	\centering
	\input{tikz/shapes.tex}
	\caption{Many bistability loops at different wavelengths.
		The loops that are closer to the microring resonance have smaller bistability regions or they have not one at all.
		Loops that are farther from the resonance have larger bistability regions.}
	\label{fig:bistability_shape}
\end{figure}

As expected, the region of bistability disappears for wavelength within a certain distance from the wavelength resonance.
Moreover, by increasing the distance between the pump and the resonance wavelengths, the bistability region becomes larger.
The range of wavelengths with which the sample has been probed is upper limited due to the growing pump power required to activate the bistability.

HOW DOES THIS COMPARE TO THE SIMULATIONS?

%\subsubsection{Bistability region edges dependence on wavelength}
%\label{sssec:bistability_region_edges_dependence_on_wavelength}
\subsubsection{Bistability region edges}
\label{sssec:bistability_region_edges}
In order to describe with more precision the abrupt jumps on the edges of the bistability region, I also set up specific measurement loops.
These loops repeatedly initialized the system with the \ac{VOA} at full absorption and then characterized the jump by sampling from few points below to few points above the bistability step.
Similarly, the other \textit{inverse} bistability step was characterized by analogous loops in which the system was initialized with the VOA at full transparency instead.

Eventually the data collected included twenty loops for each wavelength selected, which are five almost equally spaced in a wavelength range from \SIrange{1552.2}{1552.3}{\nm}.
Each of this loop has been analyzed to find the abrupt jumps from a state to the other.
A simple study on the discrete derivative was employed to achieve that.
The same procedure has been applied both to the rising loops and to the descending loops.
The results are five data points for the first kind of loops and just as much for the descending loops, as shown in \autoref{fig:bistability_jumps}.

\begin{figure}[!hbtp]
	\centering
%	\includegraphics[draft,width=9cm,height=6cm]{figures/foo.png}
	\input{tikz/jumps.tex}
	\caption{Wavelength dependence of the bistability region edges.
		Upper limits are shown as blue dots, while lower limits are shown as red dots.
		The wavelength uncertainty is assumed to be \SI{1}{\pm} for all the points and it is an estimate given by checks in betweens consecutive measures obtained with the OSA.
		The power uncertainty is given by the statistic of the data collected with the loop in power.
	}
	\label{fig:bistability_jumps}
\end{figure}

The error on each point has been evaluated as follows.
The uncertainty on the wavelength position is an estimate, given by checks on the spectrum of the source, obtained with the \ac{OSA} before and after each measure cycle.
The uncertainty of the power is calculated on the statistic of all the loops measured at the same wavelength.
Hence it is defined as the RMS error of twenty data points for each wavelength.

It is interesting to observe that the experimental data, much like the simulations, show a steeper dependence on wavelength for the upper limits that for the lower limits.
Nevertheless, both quantities seem to increase with wavelength more distant from the resonance.
Moreover, the position of the edges of the bistability region seem to be precisely defined by the parameters of the system.

\section{Test of a Trained ANN}
\label{sec:Test_of_a_Trained ANN}
The first step that I made in order to test the nonlinear response of a microring resonator as a neural network activation function is to exploit the fitted bistability curve of \autoref{eq:fit} and implement it as activation function of the model defined in \autoref{ssec:Simulated_ANN_operation}.

\subsection{Optical bistability as nonlinear activation function}
\label{ssec:Optical_bistability_as_nonlinear_activation_function}
Having obtained a description of the optical bistability of the response of a microring resonator in a wide range of wavelengths, I implemented the shape of such response in a simulated artificial neural network.
Hence, I chose one set of data from the group, such that it was neither the most distant nor the closest to the resonance.
This was made to avoid unexpected ``border effects''.
Specifically, the data belongs to the increasing half of the bistability loop for input light at \SI{1552.300}{\nm} \ref{}.

\begin{figure}[htbp]
	\centering
	\input{tikz/fit+residuals.tex}
	\caption{Curve fitting and residuals on a set of data.
	The nonlinear curve is the increasing half of a bistability loop.
	The fit is quite close to the original values, except near the jump.}
	\label{fig:fit+residuals}
\end{figure}

The curve employed to fit the data is a combination of function that are already implemented in PyTorch library.
This allows a simple implementation in the simulations.
Specifically the function is composed by \textit{Logistic} and \textit{ReLU} function
\begin{equation}
	f_{fit} \defeq b~f_{Logistic}\left[a(x-x_0)\right] + c~f_{ReLU}\left[x\right]+d~f_{ReLU}\left[x-x_0\right]+e~f_{ReLU}\left[x-x_1\right],
	\label{eq:fit}
\end{equation}
where the parameters $a$, $b$, $c$, $d$, $e$, $x_0$, and $x_1$ are fixed by the fit.

As shown in \autoref{fig:fit+residuals}, the curve fit on the chosen dataset is very close to the original data points.
This is true all over the range of powers, except near the bistability edge, where the maximum difference occurs.

\subsection{Optical bistability vs ReLU and Logistic}
\label{ssec:OBvsReLUvsSIGM}
HO PROVATO DIVERSE GEOMETRIE e DIVERSE LOSS FUNCTIONS\\
COME ADATTARE I PESI VIRTUALI A QUELLI FISICI? rappresentazione a bassa precisione?


\begin{figure}[htbp]
	\centering
	\input{tikz/Train_evolution_OB.tex}
	\caption{Evolution of the loss criterion (solid lines) throughout the epochs.
		Points represent the values of the loss criterion on the validation dataset, carried out repeatedly during the training.
	}
	\label{fig:fit_learning}
\end{figure}

\autoref{fig:fit_learning} shows the evolution of the loss and the validation of each model during the \num{2000} epochs of training.
From the evolution of the loss function we can see that every model has 

The percentage of correct answer of different models that implements the optical bistability activation function is given by \autoref{tab:ExpResults}.
The same shapes have been tested with $f_{ReLU}$ and $f_{Logistic}$ in \autoref{ssec:Simulated_ANN_operation}.

\begin{table}[htbp]
	\centering
	\begin{tabular}{c c c c r}
	\toprule
	activation	& no. hidden 	& no. nodes	& other			& Percent\\
	function		& layers 			& per layer	& parameters	& correct\\
	\midrule
	$f_{fit}$ 			& 2 & 11 & - & \SI{66}{\percent}\\
	$f_{fit}$ 			& 2 & 22 & - & \SI{55}{\percent}\\
	$f_{fit}$ 			& 3 & 11 & - & \SI{44}{\percent}\\
	$f_{fit}$ 			& 3 & 22 & - & \SI{33}{\percent}\\
	\bottomrule
	\end{tabular}
	\caption{Results of the $f_{fit}$ function for several network topologies.
	}
	\label{tab:ExpResults}
\end{table}

As we can see the performance of the $f_{fit}$ function lies in the range of the $f_{ReLU}$, even if a bit lower.
